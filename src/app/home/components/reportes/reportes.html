<div class="pt-20 pb-5 px-4">
  <section class="bg-gradient-to-b from-[#0f1a0f] to-black rounded-xl min-h-[100vh]">
    <div class="py-8 px-4 mx-auto max-w-screen-lg lg:px-8">
      <!-- Encabezado -->
      <div class="mb-8 text-center">
        <h2 class="mb-2 text-3xl md:text-4xl font-extrabold leading-tight text-white">
          Mis <span class="text-lime-400">Reportes</span>
        </h2>
        <p class="text-sm md:text-base text-gray-300">
          Revisa el historial de tus reservas, estados y puntos acumulados. Usa los filtros para
          descargar reportes según tus necesidades.
        </p>
      </div>

      <!-- Resumen (cards) -->
      <div class="grid gap-4 md:grid-cols-4 mb-8">
        <div class="bg-[#0f1a0f]/80 border border-lime-700/40 rounded-xl p-4">
          <p class="text-xs uppercase tracking-wide text-gray-400">Reservas totales</p>
          <p class="mt-2 text-2xl font-bold text-white">{{ resumen.reservasTotales }}</p>
        </div>
        <div class="bg-[#0f1a0f]/80 border border-lime-700/40 rounded-xl p-4">
          <p class="text-xs uppercase tracking-wide text-gray-400">Reservas aprobadas</p>
          <p class="mt-2 text-2xl font-bold text-lime-400">{{ resumen.reservasAprobadas }}</p>
        </div>
        <div class="bg-[#0f1a0f]/80 border border-lime-700/40 rounded-xl p-4">
          <p class="text-xs uppercase tracking-wide text-gray-400">Canceladas / No show</p>
          <p class="mt-2 text-2xl font-bold text-red-400">
            {{ resumen.canceladasNoShow }}
          </p>
        </div>
        <div class="bg-[#0f1a0f]/80 border border-lime-700/40 rounded-xl p-4">
          <p class="text-xs uppercase tracking-wide text-gray-400">Puntos actuales</p>
          <p class="mt-2 text-2xl font-bold text-lime-400">{{ resumen.puntosActuales }} pts</p>
        </div>
      </div>

      <!-- Tabs -->
      <div class="mb-6 border-b border-gray-700">
        <ul class="flex flex-wrap -mb-px text-sm font-medium text-center text-gray-400">
          <li class="mr-4">
            <button
              type="button"
              (click)="setTab('reservas')"
              class="inline-flex items-center gap-2 p-2 border-b-2 rounded-t-lg"
              [ngClass]="
                activeTab === 'reservas'
                  ? 'border-lime-500 text-lime-400'
                  : 'border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500'
              "
            >
              Historial de reservas
            </button>
          </li>
          <li class="mr-4">
            <button
              type="button"
              (click)="setTab('puntos')"
              class="inline-flex items-center gap-2 p-2 border-b-2 rounded-t-lg"
              [ngClass]="
                activeTab === 'puntos'
                  ? 'border-lime-500 text-lime-400'
                  : 'border-transparent text-gray-400 hover:text-gray-200 hover:border-gray-500'
              "
            >
              Historial de puntos
            </button>
          </li>
        </ul>
      </div>

      <!-- Contenido: Historial de reservas -->
      <div class="space-y-6" *ngIf="activeTab === 'reservas'">
        <!-- Filtros reservas -->
        <div
          class="bg-[#0f1a0f]/80 border border-gray-700 rounded-xl p-4 md:p-5 flex flex-col gap-4"
        >
          <div class="flex flex-col md:flex-row md:items-end gap-4">
            <div class="flex-1">
              <label class="block mb-1 text-xs font-medium text-gray-300"> Rango de fechas </label>
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <input
                  type="date"
                  [(ngModel)]="filtros.fechaDesde"
                  name="fechaDesde"
                  class="block w-full rounded-lg border border-gray-700 bg-black/40 px-3 py-2 text-sm text-gray-100 placeholder-gray-400 outline-none focus:ring-2 focus:ring-lime-400"
                />
                <input
                  type="date"
                  [(ngModel)]="filtros.fechaHasta"
                  name="fechaHasta"
                  class="block w-full rounded-lg border border-gray-700 bg-black/40 px-3 py-2 text-sm text-gray-100 placeholder-gray-400 outline-none focus:ring-2 focus:ring-lime-400"
                />
              </div>
            </div>

            <div class="flex-1 grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="block mb-1 text-xs font-medium text-gray-300"> Estado </label>
                <select
                  [(ngModel)]="filtros.estado"
                  name="estado"
                  class="block w-full rounded-lg border border-gray-700 bg-black/40 px-3 py-2 text-sm text-gray-100 outline-none focus:ring-2 focus:ring-lime-400"
                >
                  <option value="">Todos</option>
                  <option value="APROBADA">Aprobada</option>
                  <option value="PENDIENTE">Pendiente</option>
                  <option value="CANCELADA">Cancelada</option>
                  <option value="NO_SHOW">No show</option>
                </select>
              </div>
              <div>
                <label class="block mb-1 text-xs font-medium text-gray-300"> Sede / Cancha </label>
                <select
                  [(ngModel)]="filtros.sede"
                  name="sede"
                  class="block w-full rounded-lg border border-gray-700 bg-black/40 px-3 py-2 text-sm text-gray-100 outline-none focus:ring-2 focus:ring-lime-400"
                >
                  <option value="">Todas</option>
                  <option value="PIURA">Sede Piura</option>
                  <option value="CASTILLA">Sede Castilla</option>
                </select>
              </div>
            </div>

            <div class="flex flex-row gap-2 md:flex-col md:w-40">
              <button
                type="button"
                (click)="aplicarFiltros()"
                class="w-full inline-flex justify-center rounded-lg px-4 py-2.5 text-sm font-medium bg-lime-600 hover:bg-lime-500 text-black focus:outline-none focus:ring-4 focus:ring-lime-400/40"
              >
                Aplicar filtros
              </button>
              <button
                type="button"
                (click)="limpiarFiltros()"
                class="w-full inline-flex justify-center rounded-lg px-4 py-2.5 text-sm font-medium border border-gray-700 text-gray-200 hover:bg-gray-800"
              >
                Limpiar
              </button>
            </div>
          </div>

          <p class="text-[11px] text-gray-400">
            Los reportes se generarán según los filtros seleccionados.
          </p>
        </div>

        <!-- Acciones exportación -->
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
          <p class="text-xs text-gray-400">
            Historial de reservas realizadas con tu cuenta. Puedes exportar los datos para llevar un
            control personal.
          </p>
          <div class="flex flex-wrap gap-2">
            <button
              type="button"
              (click)="exportarReservasExcel()"
              class="inline-flex items-center rounded-lg px-4 py-2 text-xs font-medium bg-lime-600 hover:bg-lime-500 text-black focus:outline-none focus:ring-4 focus:ring-lime-400/40"
            >
              Exportar a Excel
            </button>
            <button
              type="button"
              (click)="exportarReservasCsv()"
              class="inline-flex items-center rounded-lg px-4 py-2 text-xs font-medium border border-gray-700 text-gray-200 hover:bg-gray-800"
            >
              Exportar a CSV
            </button>
          </div>
        </div>

        <!-- Tabla reservas -->
        <div class="relative overflow-x-auto border border-gray-800 rounded-xl bg-black/40">
          <table class="w-full text-sm text-left text-gray-300" id="tablaReservas">
            <thead class="text-xs uppercase bg-black/60 text-gray-400">
              <tr>
                <th scope="col" class="px-4 py-3">Fecha</th>
                <th scope="col" class="px-4 py-3">Horario</th>
                <th scope="col" class="px-4 py-3">Sede / Cancha</th>
                <th scope="col" class="px-4 py-3">Estado</th>
                <th scope="col" class="px-4 py-3">Monto</th>
                <th scope="col" class="px-4 py-3">Puntos</th>
                <th scope="col" class="px-4 py-3 text-right">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let reserva of reservasFiltradas" class="border-t border-gray-800">
                <td class="px-4 py-3 whitespace-nowrap">
                  {{ reserva.fecha | date : 'dd/MM/yyyy' }}
                </td>
                <td class="px-4 py-3">{{ reserva.horario }}</td>
                <td class="px-4 py-3">{{ reserva.sede }} - {{ reserva.cancha }}</td>
                <td class="px-4 py-3">
                  <span
                    class="inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-medium"
                    [ngClass]="{
                      'bg-emerald-900/50 text-emerald-300': reserva.estado === 'APROBADA',
                      'bg-amber-900/50 text-amber-300': reserva.estado === 'PENDIENTE',
                      'bg-red-900/50 text-red-300':
                        reserva.estado === 'CANCELADA' || reserva.estado === 'NO_SHOW'
                    }"
                  >
                    {{ reserva.estado | titlecase }}
                  </span>
                </td>
                <td class="px-4 py-3">S/ {{ reserva.monto | number : '1.2-2' }}</td>
                <td class="px-4 py-3">
                  {{ reserva.puntos > 0 ? '+' + reserva.puntos : reserva.puntos }}
                </td>
                <td class="px-4 py-3 text-right">
                  <button
                    type="button"
                    class="text-xs font-medium text-lime-400 hover:text-lime-300"
                    (click)="verDetalleReserva(reserva)"
                  >
                    Ver detalle
                  </button>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Mensaje sin datos -->
          <div class="p-4 border-t border-gray-800" *ngIf="reservasFiltradas.length === 0">
            <p class="text-xs text-gray-400">
              No se encontraron reservas con los filtros actuales.
            </p>
          </div>
        </div>
      </div>

      <!-- Sección: Historial de puntos -->
      <div
        class="mt-10 bg-[#0f1a0f]/80 border border-gray-700 rounded-xl p-4 md:p-5 space-y-4"
        *ngIf="activeTab === 'puntos'"
      >
        <div class="flex items-center justify-between gap-3">
          <h3 class="text-base font-semibold text-white">Historial de puntos</h3>
          <button
            type="button"
            (click)="exportarPuntosExcel()"
            class="inline-flex items-center rounded-lg px-4 py-2 text-xs font-medium bg-lime-600 hover:bg-lime-500 text-black focus:outline-none focus:ring-4 focus:ring-lime-400/40"
          >
            Exportar a Excel
          </button>
        </div>
        <p class="text-xs text-gray-400">
          Visualiza cómo ganaste y usaste tus puntos en Canchaplus.
        </p>

        <div class="relative overflow-x-auto border border-gray-800 rounded-xl bg-black/40">
          <table class="w-full text-sm text-left text-gray-300" id="tablaPuntos">
            <thead class="text-xs uppercase bg-black/60 text-gray-400">
              <tr>
                <th scope="col" class="px-4 py-3">Fecha</th>
                <th scope="col" class="px-4 py-3">Detalle</th>
                <th scope="col" class="px-4 py-3">Movimiento</th>
                <th scope="col" class="px-4 py-3">Puntos</th>
                <th scope="col" class="px-4 py-3">Saldo</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let mov of puntosFiltrados" class="border-t border-gray-800">
                <td class="px-4 py-3 whitespace-nowrap">
                  {{ mov.fecha | date : 'dd/MM/yyyy' }}
                </td>
                <td class="px-4 py-3">{{ mov.detalle }}</td>
                <td class="px-4 py-3">
                  <span
                    class="inline-flex items-center rounded-full px-2.5 py-0.5 text-[11px] font-medium"
                    [ngClass]="{
                      'bg-emerald-900/50 text-emerald-300': mov.tipo === 'CREDITO',
                      'bg-red-900/50 text-red-300': mov.tipo === 'DEBITO'
                    }"
                  >
                    {{ mov.tipo === 'CREDITO' ? 'Crédito' : 'Débito' }}
                  </span>
                </td>
                <td class="px-4 py-3">
                  {{ mov.puntos > 0 ? '+' + mov.puntos : mov.puntos }}
                </td>
                <td class="px-4 py-3">{{ mov.saldo }} pts</td>
              </tr>
            </tbody>
          </table>

          <div class="p-4 border-t border-gray-800" *ngIf="puntosFiltrados.length === 0">
            <p class="text-xs text-gray-400">
              No se encontraron movimientos de puntos con los filtros actuales.
            </p>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
